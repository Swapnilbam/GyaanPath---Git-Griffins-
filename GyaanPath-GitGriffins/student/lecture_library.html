<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lecture Library</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/localforage@1.10.0/dist/localforage.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Poppins:wght@800&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Devanagari:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #1a0537; background-image: linear-gradient(to bottom right, #4a00e0, #1a0537); background-repeat: no-repeat; background-attachment: fixed; color: #ffffff; }
        body.hindi-lang { font-family: 'Noto Sans Devanagari', sans-serif; }
        .font-title { font-family: 'Poppins', sans-serif; }
        body.hindi-lang .font-title { font-family: 'Noto Sans Devanagari', sans-serif; font-weight: 700; }
        
        .lecture-card { background-color: rgba(255, 255, 255, 0.1); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.2); transition: all 0.3s ease; cursor: pointer; }
        .lecture-card:hover { transform: translateY(-8px) scale(1.02); background-color: rgba(255, 255, 255, 0.15); border-color: rgba(255, 255, 255, 0.4); }
        .background-wrapper { position: fixed; top: 0; left: 0; width: 100%; height: 100%; overflow: hidden; z-index: -1; }
        .circuit-line { position: absolute; stroke: rgba(255, 255, 255, 0.1); stroke-width: 1.5; fill: none; stroke-dasharray: 10 20; animation: dash 20s linear infinite; }
        @keyframes dash { to { stroke-dashoffset: 1000; } }
        .star { position: absolute; background: white; border-radius: 50%; animation: twinkle 5s infinite ease-in-out; }
        @keyframes twinkle { 0%, 100% { opacity: 0.3; } 50% { opacity: 0.8; } }
        .modal-overlay { transition: opacity 0.3s ease; }
        .modal-content { transition: transform 0.3s ease, opacity 0.3s ease; }
        
        /* Language Dropdown */
        .lang-dropdown { position: relative; display: inline-block; }
        .lang-dropbtn { background: transparent; border: 1px solid rgba(255, 255, 255, 0.5); color: #fff; padding: 0.4rem 0.8rem; border-radius: 15px; cursor: pointer; font-size: 0.9rem; display: flex; align-items: center; gap: 0.5rem; transition: all 0.3s ease; }
        .lang-dropbtn:hover { background: rgba(255, 255, 255, 0.2); }
        .lang-dropbtn .fa-chevron-down { font-size: 0.7rem; transition: transform 0.3s ease; }
        .lang-dropdown.active .lang-dropbtn .fa-chevron-down { transform: rotate(180deg); }
        .lang-dropdown-content { display: none; position: absolute; background-color: rgba(20, 20, 30, 0.9); backdrop-filter: blur(5px); min-width: 110px; box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2); z-index: 50; border-radius: 10px; overflow: hidden; right: 0; margin-top: 8px; }
        .lang-dropdown-content a { color: #fff; padding: 10px 14px; text-decoration: none; display: block; font-size: 0.9rem; transition: background-color 0.2s; }
        body.hindi-lang .lang-dropdown-content a { font-family: 'Noto Sans Devanagari', sans-serif; }
        .lang-dropdown-content a:hover { background-color: rgba(255, 255, 255, 0.1); }
        .lang-dropdown.active .lang-dropdown-content { display: block; }
    </style>
</head>
<body class="antialiased">
    <div class="background-wrapper">
        <svg width="100%" height="100%"><path class="circuit-line" d="M -100 200 Q 200 100 400 300 T 800 250 T 1200 400 T 1600 300 T 2000 500"></path></svg>
        <script>
            const bg = document.querySelector('.background-wrapper');
            for (let i = 0; i < 50; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                const size = Math.random() * 2 + 1;
                star.style.width = `${size}px`; star.style.height = `${size}px`;
                star.style.top = `${Math.random() * 100}%`; star.style.left = `${Math.random() * 100}%`;
                star.style.animationDelay = `${Math.random() * 5}s`;
                bg.appendChild(star);
            }
        </script>
    </div>

    <!-- Video Player Modal -->
    <div id="video-modal" class="fixed inset-0 bg-black/80 flex items-center justify-center p-4 z-50 hidden modal-overlay opacity-0">
        <div class="bg-gray-900 rounded-2xl shadow-xl w-full max-w-4xl modal-content transform scale-95 opacity-0 flex flex-col max-h-[90vh]">
            <div class="p-4 flex justify-between items-center border-b border-gray-700">
                <h2 id="modal-lecture-title" class="text-xl font-bold text-white">Lecture Title</h2>
                <button id="close-modal-btn" class="text-gray-400 hover:text-white text-3xl leading-none">&times;</button>
            </div>
            <div class="flex-grow p-1 bg-black">
                <video id="video-player" class="w-full h-full" controls></video>
            </div>
        </div>
    </div>

    <div class="relative min-h-screen p-4 sm:p-6 lg:p-8">
        <div class="w-full max-w-7xl mx-auto">
            <header class="flex items-center justify-between mb-10">
                <div>
                    <h1 class="font-title text-4xl md:text-5xl font-extrabold tracking-tight" data-lang-key="main_title">Lecture Library</h1>
                    <p class="mt-2 text-lg text-white/70" data-lang-key="main_subtitle">Access and download past lectures for offline study.</p>
                </div>
                 <div class="flex items-center gap-4">
                    <a href="dashboard_student.html" class="px-5 py-2 rounded-lg bg-white/10 hover:bg-white/20 text-sm font-semibold transition-colors flex-shrink-0" data-lang-key="back_to_dashboard">&larr; Back to Dashboard</a>
                     <div class="lang-dropdown">
                        <button class="lang-dropbtn">
                            <span id="current-lang-text">EN</span> <i class="fas fa-chevron-down"></i>
                        </button>
                        <div class="lang-dropdown-content">
                            <a href="#" data-lang="en">English</a>
                            <a href="#" data-lang="hi">हिन्दी</a>
                        </div>
                    </div>
                </div>
            </header>
            
            <div id="lecture-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            </div>

            <div id="empty-state" class="hidden text-center py-20 px-6 bg-white/5 rounded-2xl">
                <svg xmlns="http://www.w3.org/2000/svg" class="mx-auto h-24 w-24 text-gray-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M4 20h16a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.93a2 2 0 0 1-1.66-.9l-.82-1.2A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13c0 1.1.9 2 2 2Z" /><path d="m10 14 4-2-4-2v4Z" /></svg>
                <h3 class="mt-4 text-2xl font-bold text-white" data-lang-key="empty_title">No Lectures Available</h3>
                <p class="mt-2 text-white/60" data-lang-key="empty_subtitle">Your lecturer hasn't uploaded any sessions yet.</p>
            </div>
        </div>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', async () => {
             const translations = {
                en: {
                    doc_title: "Lecture Library",
                    main_title: "Lecture Library",
                    main_subtitle: "Access and download past lectures for offline study.",
                    back_to_dashboard: "← Back to Dashboard",
                    empty_title: "No Lectures Available",
                    empty_subtitle: "Your lecturer hasn't uploaded any sessions yet.",
                    uploaded: "Uploaded",
                    watch_now: "Watch Now →"
                },
                hi: {
                    doc_title: "व्याख्यान लाइब्रेरी",
                    main_title: "व्याख्यान लाइब्रेरी",
                    main_subtitle: "ऑफ़लाइन अध्ययन के लिए पिछले व्याख्यानों तक पहुंचें और डाउनलोड करें।",
                    back_to_dashboard: "← डैशबोर्ड पर वापस जाएं",
                    empty_title: "कोई व्याख्यान उपलब्ध नहीं है",
                    empty_subtitle: "आपके व्याख्याता ने अभी तक कोई सत्र अपलोड नहीं किया है।",
                    uploaded: "अपलोड किया गया",
                    watch_now: "अभी देखें →"
                }
            };
            let currentLang = 'en';

            const lectureList = document.getElementById('lecture-list');
            const emptyState = document.getElementById('empty-state');
            const videoModal = document.getElementById('video-modal');
            const closeModalBtn = document.getElementById('close-modal-btn');
            const videoPlayer = document.getElementById('video-player');
            const modalTitle = document.getElementById('modal-lecture-title');

            localStorage.setItem('newLectureCount', '0');
            const channel = new BroadcastChannel('lecture_updates_channel');

            const langDropdown = document.querySelector('.lang-dropdown');
            const dropdownButton = langDropdown.querySelector('.lang-dropbtn');
            const dropdownLinks = document.querySelectorAll('.lang-dropdown-content a');
            const currentLangText = document.getElementById('current-lang-text');

            function setLanguage(lang) {
                currentLang = lang;
                localStorage.setItem('gyaanpath_lang', lang);
                document.body.classList.toggle('hindi-lang', lang === 'hi');
                document.title = translations[lang].doc_title;
                document.querySelectorAll('[data-lang-key]').forEach(el => {
                    const key = el.dataset.langKey;
                    if (translations[lang][key]) el.textContent = translations[lang][key];
                });
                currentLangText.textContent = lang === 'en' ? 'EN' : 'HI';
                langDropdown.classList.remove('active');
                loadLectures(); // Re-render lectures with new language
            }

            dropdownButton.addEventListener('click', (e) => { e.stopPropagation(); langDropdown.classList.toggle('active'); });
            window.addEventListener('click', (e) => { if (!langDropdown.contains(e.target)) langDropdown.classList.remove('active'); });
            dropdownLinks.forEach(link => {
                link.addEventListener('click', (e) => { e.preventDefault(); setLanguage(link.getAttribute('data-lang')); });
            });

            async function loadLectures() {
                lectureList.innerHTML = '';
                const keys = await localforage.keys();
                const lectureKeys = keys.filter(k => k.startsWith('lecture_'));

                if (lectureKeys.length === 0) {
                    emptyState.classList.remove('hidden');
                } else {
                    emptyState.classList.add('hidden');
                    const lectures = [];
                    for (const key of lectureKeys) {
                        lectures.push(await localforage.getItem(key));
                    }
                    lectures.sort((a, b) => new Date(b.uploadedAt) - new Date(a.uploadedAt));
                    
                    lectures.forEach(lecture => {
                        const card = createLectureCard(lecture);
                        lectureList.appendChild(card);
                    });
                }
            }
            
            function createLectureCard(lecture) {
                const card = document.createElement('div');
                card.className = 'lecture-card rounded-2xl p-6';
                card.dataset.lectureId = lecture.id;

                const date = new Date(lecture.uploadedAt);
                const formattedDate = date.toLocaleDateString(currentLang === 'hi' ? 'hi-IN' : 'en-US', { year: 'numeric', month: 'long', day: 'numeric' });

                card.innerHTML = `
                    <div class="flex items-center space-x-4 mb-4">
                        <div class="w-14 h-14 bg-white/10 rounded-xl flex items-center justify-center flex-shrink-0">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-amber-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="m10 14 4-2-4-2v4Z"/><path d="M4 20h16a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.93a2 2 0 0 1-1.66-.9l-.82-1.2A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13c0 1.1.9 2 2 2Z"/></svg>
                        </div>
                        <div>
                            <h2 class="text-xl font-bold font-title">${lecture.title}</h2>
                            <p class="text-white/70 text-sm">${translations[currentLang].uploaded}: ${formattedDate}</p>
                        </div>
                    </div>
                    <div class="text-right font-semibold text-fuchsia-300">
                        ${translations[currentLang].watch_now}
                    </div>
                `;
                card.addEventListener('click', () => openVideoPlayer(lecture.id));
                return card;
            }

            async function openVideoPlayer(lectureId) {
                const lecture = await localforage.getItem(lectureId);
                if (lecture && lecture.video) {
                    modalTitle.textContent = lecture.title;
                    const videoURL = URL.createObjectURL(lecture.video);
                    videoPlayer.src = videoURL;
                    videoModal.classList.remove('hidden');
                    setTimeout(() => {
                        videoModal.classList.remove('opacity-0');
                        videoModal.querySelector('.modal-content').classList.remove('opacity-0', 'scale-95');
                    }, 10);
                }
            }

            function closeVideoPlayer() {
                videoPlayer.pause();
                videoPlayer.src = '';
                videoModal.classList.add('opacity-0');
                videoModal.querySelector('.modal-content').classList.add('opacity-0', 'scale-95');
                setTimeout(() => videoModal.classList.add('hidden'), 300);
            }

            closeModalBtn.addEventListener('click', closeVideoPlayer);
            
            channel.onmessage = (event) => {
                if(event.data.action === 'new_lecture' || event.data.action === 'lecture_deleted') {
                    loadLectures(); 
                }
            };
            
            const savedLang = localStorage.getItem('gyaanpath_lang') || 'en';
            setLanguage(savedLang);
        });
    </script>
</body>
</html>
